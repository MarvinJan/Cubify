var _createClass=function(){function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,s=Array(e.length);t<e.length;t++)s[t]=e[t];return s}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Cubify=function(){function s(e,t){_classCallCheck(this,s),this.front=e,this.faces=t.faces||{},this.width=t.width||this.getDefaultWidth(),this.onlyX=t.onlyX||!1,this.onlyY=!t.onlyX&&(t.onlyY||!1),this.interactive=t.interactive||!1,this.snap=t.snap||!1,this.parent=this.front.parentNode,this.bgColor=this.getBackgroundColor(),this.commonStyle={width:this.width+"px",height:this.width+"px"},this.sceneStyle={perspective:4*this.width+"px"},this.faceStyle={position:"absolute",top:0,left:0},this.cubeStyle={transform:"translateZ(-"+this.width/2+"px)","transform-style":"preserve-3d"},this.renderCube(),t.interactive&&(this.angleX=0,this.angleY=0,this.setUpListeners())}return _createClass(s,[{key:"getBackgroundColor",value:function(){return window.getComputedStyle(this.front,null).getPropertyValue("background-color")}},{key:"getDefaultWidth",value:function(){var t=[],e=function(e){e&&t.push(e.offsetWidth,e.offsetHeight)};return e(this.front),e(this.faces.back),e(this.faces.right),e(this.faces.top),e(this.faces.bottom),e(this.faces.left),Math.max.apply(Math,t)}},{key:"generateDOM",value:function(e,t,s){var n=s||document.createElement("div");if(n.classList.add(t),"string"==typeof e)return this.setStyle(n,e),n;var a=Object.assign({},this.commonStyle,e),i=Object.keys(a).map(function(e){return e+": "+a[e]+";"}).join(" ");return this.setStyle(n,i),n}},{key:"setFaceStyle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"X",s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return e.style.transform="rotate"+t+"("+s+"deg) translateZ("+this.width/2+"px)"}},{key:"setStyle",value:function(e,t){return e.setAttribute("style",t)}},{key:"composeCube",value:function(){var e=this.generateDOM(this.sceneStyle,"cubify__scene"),t=this.generateDOM(this.cubeStyle,"cubify__cube"),s=this.generateDOM(this.faceStyle,"cubify__face",this.front),n=this.faces.back?this.generateDOM(this.faceStyle,"cubify__face",this.faces.back):this.generateDOM(this.faceStyle,"cubify__face"),a=this.faces.top?this.generateDOM(this.faceStyle,"cubify__face",this.faces.top):this.generateDOM(this.faceStyle,"cubify__face"),i=this.faces.bottom?this.generateDOM(this.faceStyle,"cubify__face",this.faces.bottom):this.generateDOM(this.faceStyle,"cubify__face"),r=this.faces.right?this.generateDOM(this.faceStyle,"cubify__face",this.faces.right):this.generateDOM(this.faceStyle,"cubify__face"),c=this.faces.left?this.generateDOM(this.faceStyle,"cubify__face",this.faces.left):this.generateDOM(this.faceStyle,"cubify__face");return this.setFaceStyle(s,"Y",0),this.setFaceStyle(n,"Y",180),this.setFaceStyle(a,"X",90),this.setFaceStyle(i,"X",-90),this.setFaceStyle(r,"Y",90),this.setFaceStyle(c,"Y",-90),t.append(s,n,a,i,c,r),e.append(t),this.cube=t,e}},{key:"renderCube",value:function(){this.parent.append(this.composeCube())}},{key:"calculateDeltaAngles",value:function(e,t,s){var n=0,a=0;return"touchmove"===e.type?(this.onlyY||(n=t-e.touches[0].clientX),this.onlyX||(a=s-e.touches[0].clientY)):(this.onlyY||(n=t-e.clientX),this.onlyX||(a=s-e.clientY)),[this.angleX-n/2,this.angleY+a/2]}},{key:"rotateCube",value:function(e,t){this.cube.style.transform="translateZ(-"+this.width/2+"px) rotateY("+e+"deg) rotateX("+t+"deg)"}},{key:"snapAngles",value:function(e,t){var s=function(e){var t=e%90;return 45<Math.abs(t)?(90-Math.abs(t))*(t/Math.abs(t)):-t};return e+=s(e),t+=s(t),this.rotateCube(e,t),[e,t]}},{key:"setAngles",value:function(e,t){this.onlyY||(this.angleX=e),this.onlyX||(this.angleY=t)}},{key:"setUpListeners",value:function(){var i=this;this.cube.addEventListener("touchstart",function(e){e.preventDefault();var t=e.touches[0].clientX,s=e.touches[0].clientY,n=i.calculateDeltaAngles(e,t,s),a=function(e){i.rotateCube.apply(i,_toConsumableArray(n)),n=i.calculateDeltaAngles(e,t,s)};document.addEventListener("touchmove",a),document.addEventListener("touchend",function e(){i.snap&&(n=i.snapAngles.apply(i,_toConsumableArray(n))),n&&i.setAngles.apply(i,_toConsumableArray(n)),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",e)})},{passive:!1}),this.cube.addEventListener("mousedown",function(e){e.preventDefault();var t=e.clientX,s=e.clientY,n=i.calculateDeltaAngles(e,t,s),a=function(e){i.rotateCube.apply(i,_toConsumableArray(n)),n=i.calculateDeltaAngles(e,t,s)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",function e(){i.snap&&(n=i.snapAngles.apply(i,_toConsumableArray(n))),n&&i.setAngles.apply(i,_toConsumableArray(n)),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",e)})})}}]),s}();